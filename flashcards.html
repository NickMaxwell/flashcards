<!DOCTYPE html>

<html>
<head>
  <meta charset='utf-8'/>
  <title>Learning System</title>
  
<!-- CSS -------------------->
  <style>
    #timeDisplays {
      float: right; 
    }
    #mainSpan {
      float: left; 
    }
  </style>

<!--------------- Create Globally Held Data -------------------------->

  <script> 
    'use strict'; 
  
    // systemLog is a global array that holds data on what happens and when
    let systemLog = []; 
    
	  let timeStarted = new Date(); 
    systemLog.push(['Open flashcards', timeStarted]); 
    
    // for estimating average time per card 
    let cardsGuessed = 0; 
    
    // Global array that will be used to display cards
    let displayList = [false]; 
  
    // createCardMode records mode of card creation step
    // 'Create' = user clicked on "Create Cards".  
    // 'Revise' = user clicked on "Fix Card" while running flashcards
    let createCardMode = 'Create'; 
  
    // Which card is durrently being displayed
    let currentCard = -1; 
    
  </script>

  <script type='text/javascript' src='flashcard_data.js'></script>
  <script type='text/javascript' src='tidy_cards.js'></script>

  <script>
    'use strict'; 
    
    /** @return {number} */
    // for displaying time in flashcards
    function minutesElapsed() {  
      // Minutes elapsed since starting to work on the flashcards.  
      // This function needs to exist before import the rest of the modules.
      const timeNow = new Date(); 
      const hoursSoFar = timeNow.getHours() - timeStarted.getHours(); 
      return timeNow.getMinutes() - timeStarted.getMinutes() + hoursSoFar*60; 
    }
  </script>

  
  <!--------------- Modules ------------------------------------------>

  <!-- Data entry interface for creating flashcards -->  
  <script type='text/javascript' src='new_cards.js'></script>

  <!-- Trains memory by showing flashcards.  Quick&Dirty spaced learning -->
  <script type='text/javascript' src='run_cards.js'></script>

  <!-- Storing item data and log -->  
  <script type='text/javascript' src='save.js'></script>

</head>


<body>

<span id='mainSpan'>

<!-- control bar -->
  <input type='button' 
      id='createFlashcardsButton' 
      value='Create Flashcards' 
      onclick='createFlashcards()'/>
  <input type='button' 
      id='runFlashcardsButton' 
      value='Run Flashcards' 
      onclick='runFlashcard()'/>
  <input type='button' value='Save' onclick='saveData()'/>

  
<!-- Module window -->
  <div id='moduleWindow'></div>
  
</span>


<span id='timeDisplays'>
  Started
  <div id='startTime'></div>
  So far
  <div id='elapsedTime'></div>
  Estimated remaining
  <div id='estimatedRemainingTime'></div>
  Estimated finish
  <div id='estimatedStopTime'></div>
</span>


<script>
'use strict'; 
// Initial time info 

function prettyPrintTime(timeToShow) {

  let hours = timeToShow.getHours(); 
  let ampm = 'am'
  if (hours > 12) {
    hours -= 12; 
    ampm = 'pm'; 
  } else if (hours === 0) {
    hours = 12; 
  }

  // Left pad with zeroes as needed
  let minToGo = '0' + timeToShow.getMinutes(); 
  minToGo = minToGo.slice(minToGo.length - 2, 3); 
  
  return '<strong>' + hours + ':' + minToGo + ampm + '</strong><p>'; 
}

document.getElementById('startTime').innerHTML = prettyPrintTime(timeStarted); 


function showTimeSoFar() {
  const elapsedTimeLabel = document.getElementById('elapsedTime')
  elapsedTimeLabel.innerHTML =  
      '<strong>' + minutesElapsed() + ' minutes</strong><p>'; 
}

showTimeSoFar(); 

function estimateRemainingTime() {
  // quick and dirty estimate
  const cardsToGo = countTrue(displayList); 
  const minutesSoFar = minutesElapsed(); 
  const minutesToGo = cardsToGo*((0.01 + minutesSoFar)/cardsGuessed); 
  
  const remainingTimeLabel = document.getElementById('estimatedRemainingTime')
  remainingTimeLabel.innerHTML = 
      '<strong>' + Math.round(minutesToGo) + ' minutes</strong><p>'; 
      
  let timeEnd = new Date(); 
  timeEnd.setMinutes( timeEnd.getMinutes() + minutesToGo ); 
  
  const stopTimeLabel = document.getElementById('estimatedStopTime')
  stopTimeLabel.innerHTML = 
      '<strong>' + prettyPrintTime(timeEnd) + '</strong><p>';
}

estimateRemainingTime(); 
    
</script>
</body>
</html>